<div class="container">
  <div class="row justify-content-center">
    <div class="col-12">

      <h4><strong><%= @event.sport.sport_name.upcase %></strong></h4>
      <h5>Créé par <strong><%= @event.user.first_name %></strong> (<%= @event.user.age %> ans, <%= @event.user.city %>) le <%=@event.created_at.strftime("%d/%m/%Y à %kh%M")%></h5>
      <%= @event.description %><br>

      <% if @event.age_mini.nil? %>
      <% else %>
      <span>Age mini : <strong><%= @event.age_mini %> ans</strong></span>
      <% end %><br>
      <% if @event.age_maxi.nil? %>
      <% else %>
      <span>Age maxi : <strong><%= @event.age_maxi %> ans</strong></span>
      <% end %><br>

      <% if @event.players_number == 1 %>
        <span><strong><%= @event.players_number %></strong> place disponible</span><br>
      <% else %>
        <span><strong><%= @event.players_number %></strong> places disponibles</span><br>
      <% end %>

      <% if @event.level.nil? %>
      <span>Tout niveau accepté</span><br>
      <% else %>
      <span>Niveau minimum requis : <strong><%= @event.level %></strong></span><br>
      <% end %>

      <% if @event.price.nil? || @event.price == 0 %>
      <span>Gratuit</span><br>
      <% else %>
      <span>Prix : <%= @event.price %> €</span><br>
      <% end %>

      <span>Le <%= @event.date.strftime("%d/%m/%Y") %> à <%= @event.time.strftime("%kh%M") %></span><br>
      <span>Lieu de rendez-vous : <%= @event.address %></span><br><br>

      <%= link_to "Je m'inscris !", booking_path(@event), class: "btn btn-outline-success" %>
      <%= link_to "Retour au menu", events_path, class: "btn btn-outline-secondary" %><br><br>

      <div class="d-flex" style="width: 100% ; height: 190px;"
        data-controller="map"
        data-map-markers-value="<%= @markers.to_json %>"
        data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
      </div><br>

      <% unless @event.user != current_user %>
        <%= link_to "Modifier", edit_event_path(@event), class: "btn btn-outline-warning" %>
      <% end %>
      <% if @event.user == current_user && Date.today < @event.date %>
        <%= link_to "Supprimer", event_path(@event), class: "btn btn-outline-danger", data: { turbo_method: :delete, turbo_confirm: "supprimer ?" } %><br><br>
      <% end %><br>

      <div class="second-container">
        <% if @event.reviews.blank? %>
          <h5>Aucun avis</h5>
        <% else %>
          <h5><strong><%= @event.reviews.size %></strong> avis - Note moyenne : <%= @event.reviews.average(:rating).round(1) %> / 5</h5>
        <% end %>


        <% if current_user.events.include?(@event) && @event.bookings.find_by(user:current_user) == "accepté" && Date.today > @event.date %>
          <% if @event.reviews.blank? %>
            <p>Sois le premier à laisser un avis</p>
          <% else %>
            <% @event.reviews.each do |review| %>
              <%= review.rating.round(0) %>
              <span>/ 5  -   </span>
              <%= review.comment %><br>
            <% end %>
          <% end %><br>
      </div>
      <div class="col-12 col-sm-4">
          <%= simple_form_for([@event, @review]) do |f| %>
          <%= f.input :comment, label: "Avis", placeholder: "Laisse un avis" %>
          <%= f.input :rating, label: "Note", placeholder: "Note (1 à 5)" %>
          <%= f.button :submit, class: "btn btn-outline-warning" %><br><br>
          <% end %>
        <% else %>
          <p>Vous devez avoir participé à cet événement pour laisser un avis</p>
        <% end %>
      </div>
  </div>
</div>
