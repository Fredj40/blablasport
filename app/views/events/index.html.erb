<%# <video id="background-video" autoplay muted loop id="myVideo">
  <source src="https://res.cloudinary.com/di7k88pkv/video/upload/v1676656463/production_ID_4440937_yjqeyx.mp4" type="video/mp4">
</video> %>

<video id="background-video" autoplay muted loop id="myVideo">
  <source src="https://res.cloudinary.com/di7k88pkv/video/upload/v1676656463/production_ID_4440937_yjqeyx.mp4" type="video/mp4">
</video>

<div class="logo-index-mobile">
  <div class="logo-index">
      <%= image_tag "https://res.cloudinary.com/di7k88pkv/image/upload/v1675864703/agenx4hoeac8j1gufekm.png", alt: "BlaBlaSport" %>
  </div>
</div>

<div class="hidden-mobile">
  <div class= "middle-container">
    <h1>Rejoins la communauté BLABLASPORT !</h1>
    <h2>LE réseau sportif</h2>
    <h3>Trouve des adversaires Rejoins une équipe</h3>
    <h4>Découvre de nouveaux sports Organise ta cession</h4>
    <h5>Rencontre de nouveaux joueurs et suis-les !</h5>
  </div>
</div>

<div class="diagonal-box"></div>
<div class="diagonal-box2"></div>

<div class="search-index-form">

  <form class="form_search row">
    <%= simple_form_for :search, method: :get, defaults: { required: false } do |f| %>
      <div class="col-12 col-lg-12 col-sm-12">
        <input type="search"  name= 'search' value: params.dig(:search) class="form-control" id="inputRecherche3" placeholder= "Je cherche une activité, ex : Foot à Paris">
        <button type="submit" class="btn btn-info">Go</button>
      </div>
    <% end %>
  </form>

  <div class="add-activity">
    <%= link_to "Je publie une activité, je cherche des joueurs", new_event_path, class: "btn btn-info" %>
  </div>

</div>

<div class="events-container">
  <div class="container">
    <div class="row">
      <div class= "events_card col-12 col-lg-8">
        <%# <h1>Evénements à venir</h1> %>
        <% if @events.empty? %><br>
          <div class="d-flex justify-content-evenly"><p>Il n'y a pas de résultat avec ces critères</p></div>
        <% else %>
          <div class= "events_cards">
            <% @events.first(30).each do |event| %>
              <% unless Date.today > event.date %>
                <div class="event-card" data-bs-customClass="popover-description" data-controller="popover" data-bs-toggle="popover" data-bs-trigger="hover" data-bs-placement="right" title="Description" data-bs-content="<%= event.description %>">
                  <h3><strong><%= event.sport.sport_name %></strong></h3>
                  <h4><strong><%= event.address.split.last(2).first.chomp(',') %></strong></h4>
                  <h4><i class="fa-solid fa-circle-info" data-controller="tooltip" data-bs-toggle="tooltip" data-bs-placement="top" data-html="true"
                  title="Niveau minimum requis: <%= event.level %><% if event.age_mini.nil? %><% else %> - Age mini : <%= event.age_mini %><% end %>
                  <% if event.age_maxi.nil? %><% else %> - Age maxi : <%= event.age_maxi %> ans<% end %>"></i></h4>
                  <h5><%= event.date.strftime("%d/%m/%Y") %><br><%= event.time.strftime("%kh%M") %></h5>
                  <h5>
                    <% if event.players_number - event.bookings.where(booking_status: "Acceptée").count > 1 %>
                      <div class="badge-success"><%= event.players_number - event.bookings.where(booking_status: "Acceptée").count %> places</div>
                    <% elsif event.players_number - event.bookings.where(booking_status: "Acceptée").count == 1 %>
                      <div class="badge-warning">1 place !</div>
                    <% else event.players_number - event.bookings.where(booking_status: "Acceptée").count == nil %>
                      <div class="badge-danger">Complet</div>
                    <% end %>
                  </h5>
                  <%# <h6>Créé le <%= event.created_at.strftime("%d/%m/%Y") %>
                  <h6>Créé par <strong><%= event.user.first_name %></strong><br>
                    <%# <% unless event.user.number_of_events == nil %>
                      <%# <% if event.user.number_of_events == 1 %>
                        <%# <span> (1 partie organisée)</span> %>
                      <%# <% else %>
                        <%# <span> (<%= event.user.number_of_events %>
                      <%# parties organisées) </span> %>
                      <%# <% end %>
                    <%# <% end %>
                    <% starfull = event.user.average_rating %>
                    <% unless starfull == "Pas de note" %>
                      <% starfull.times do %>
                        <i class="fa-solid fa-star"></i>
                      <% end %>
                      <% (5-starfull).times do %>
                        <i class="fa-regular fa-star"></i>
                      <% end %>
                    <% end %>
                  </h6>
                  <%= link_to "Voir le détail", event_path(event), class: "btn btn-outline-warning btn-sm" %>
                </div>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>

      <div class= "col-12 col-lg-1"></div>

      <div class= "feed_card col-12 col-lg-3">

        <div id="map" data-controller="map" data-map-markers-value="<%= @markers.to_json %>" data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"></div>

        <div class="activity-feed">
        <% @activities.each do |activity| %>
          <div class="activity" style="display: flex; flex-direction: column; align-items: center; margin-top: 10px; background-color: black; opacity: 0.7; color: white; padding: 10px; border-radius: 10px;">
            <% if activity.key == "event.create" %>
              <span><strong><%= activity.trackable.user.first_name %></strong> a créé un nouvel événement qui aura lieu à <%= activity.trackable.address.split.last(2).first.chomp(',') %> le <%= activity.trackable.date.strftime("%d/%m/%Y") %> à <%= activity.trackable.time.strftime("%kh%M") %></span><%= activity.created_at %><%= time_ago_in_words(activity.created_at) %>
            <% elsif activity.key == "event.update" %>
              <span><strong><%= activity.trackable.user.first_name %></strong> a modifié son événement <%= activity.trackable.sport.sport_name %> à <%= activity.trackable.address.split.last(2).first.chomp(',') %><br>Il y a <%= time_ago_in_words(activity.created_at)%></span>
            <% elsif activity.key == "message.create" %>
              <span><strong><%= activity.trackable.user.first_name %></strong> a posté un message dans la chatroom <%= activity.trackable.chatroom.event.sport.sport_name %> - <%= activity.trackable.chatroom.event.address.split.last(2).first.chomp(',') %><br>Il y a <%= time_ago_in_words(activity.created_at)%><%= link_to "Voir le détail", event_path(activity.trackable.chatroom.event.id) %></span>
            <% elsif activity.key == "booking.create" %>
              <span><strong><%= activity.trackable.user.first_name %></strong> s'est inscrit à l'événement <%= activity.trackable.event.sport.sport_name %> à <%= activity.trackable.event.address.split.last(2).first.chomp(',') %><br>Il y a <%= time_ago_in_words(activity.created_at)%><%= link_to "Voir le détail", event_path(activity.trackable.event.id) %></span>
            <% elsif activity.key == "user.create" %>
              <span><strong><%= activity.trackable.first_name %></strong> a rejoint la communauté BlaBlaSport! <br>Il y a <%= time_ago_in_words(activity.created_at)%></span>
            <% elsif activity.key == "review.create" %>
              <span><strong><%= activity.trackable.user.first_name %></strong> a laissé un avis aprés sa participation au <%= activity.trackable.event.sport.sport_name %> à <%= activity.trackable.event.address.split.last(2).first.chomp(',') %><br>Il y a <%= time_ago_in_words(activity.created_at)%></span>
            <% elsif activity.key == "friendship.update" %>
              <span><strong><%= activity.trackable.user.first_name %></strong> et <%= activity.trackable.friend.first_name %> sont maintenants amis <%= activity.trackable.user.first_name %><br>Il y a <%= time_ago_in_words(activity.created_at)%></span>
            <% end %>
          </div>
        <% end %>

          <div class="events-passed"><h1>Evénements passés</h1>
            <% @events.first(10) %>
            <% @events.each do |event| %>
              <% unless Date.today < event.date %>
                <div class="event-passed">
                <%# data-controller="popover" data-bs-toggle="popover" data-bs-trigger="hover" data-bs-placement="right" title="Description" data-bs-content="<%= event.description %>
                <h4><strong><%= event.sport.sport_name %></strong>
                  <span> - <strong><%= event.address.split.last(2).first.chomp(',') %></strong><br>Le <%= event.date.strftime("%d/%m/%Y") %> à <%= event.time.strftime("%kh%M") %><br></h4>
                    <%# <h6>Créé le <%= event.created_at.strftime("%d/%m/%Y") %>
                    <h6>Créé par <strong><%= event.user.first_name %></strong>
                      <% starfull = event.user.average_rating %>
                      <% unless starfull == "Pas de note" %>
                        <% starfull.times do %>
                          <i class="fa-solid fa-star"></i>
                        <% end %>
                        <% (5-starfull).times do %>
                          <i class="fa-regular fa-star"></i>
                        <% end %>
                      <% end %><br>
                      <% unless event.user.number_of_events == nil %>
                        <% if event.user.number_of_events == 1 %>
                          <span> (1 partie organisée)</span>
                        <% else %>
                          <span> (<%= event.user.number_of_events %> parties organisées)</span><br>
                        <% end %>
                      <% end %>
                    </h6>
                  <%= link_to "Voir le détail", event_path(event), class: "btn btn-secondary btn-sm" %>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
    </div>
  </div>
</div>
